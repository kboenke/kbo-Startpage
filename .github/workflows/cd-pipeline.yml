name: CD Pipeline

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master]

jobs:
  validate_version:
    runs-on: ubuntu-latest
    steps:
      - name: Clone repository
        uses: actions/checkout@v4

      - name: Validate version format
        run: |
          # Extract version from manifest.json
          VERSION=$(jq -r '.version' src/manifest.json)
          echo "Found version: $VERSION"
          
          # Check if version matches the pattern number.number.number
          if [[ ! $VERSION =~ ^[0-9]+\.[0-9]+\.[0-9]+$ ]]; then
            echo "❌ Error: Version '$VERSION' is not in the correct format."
            echo "Expected format: number.number.number (e.g., 1.9.0)"
            echo "Development versions with suffixes like '-dev' are not allowed in CD pipeline."
            exit 1
          fi
          
          echo "✅ Version format is valid: $VERSION"
